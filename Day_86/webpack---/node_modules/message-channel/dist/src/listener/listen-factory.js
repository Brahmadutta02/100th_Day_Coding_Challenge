'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.default = listenFactory;

var _utils = require('../utils');

function listenFactory(port, callback) {
    port.onmessage = function(e) {
        var originalMessage = e.data;

        var _parseChannelMessage = (0, _utils.parseChannelMessage)(originalMessage),
            id = _parseChannelMessage.id,
            payload = _parseChannelMessage.payload;

        var reply = function reply(replyMessage) {
            port.postMessage((0, _utils.constructChannelMessage)(replyMessage, id));
        };

        var modifiedEvent = {
            data: payload,
            origin: e.origin,
            lastEventId: e.lastEventId,
            source: e.source,
            ports: e.ports
        };

        callback(modifiedEvent, reply);
    };
}